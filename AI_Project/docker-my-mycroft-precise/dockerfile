# ——— 使用带 glibc 的 ARM64 Debian 作为基础镜像 ———
FROM --platform=linux/arm64 debian:stable-slim



# 安装运行时依赖：PortAudio、ALSA、数学库等
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
      libatlas-base-dev \
      portaudio19-dev \
      alsa-utils \
    && rm -rf /var/lib/apt/lists/*

# 创建工作目录
WORKDIR /opt/precise

# 把本地的 precise-engine 和模型文件复制进来
COPY precise-engine /opt/precise/precise-engine
COPY mike-test.pb  /opt/precise/mike-test.pb
COPY mike-test.pb.params  /opt/precise/mike-test.pb.params

# 确保可执行权限
RUN chmod +x /opt/precise/precise-engine

# （可选）如果你需要 Python wrapper，取消下面注释并安装
# RUN apt-get update && \
#     apt-get install -y python3-pip && \
#     pip3 install --no-cache-dir mycroft-precise && \
#     rm -rf /root/.cache/pip

# 启动命令：直接运行二进制监听唤醒词
ENTRYPOINT ["/opt/precise/precise-engine/precise-engine", "/opt/precise/mike-test.pb"]
